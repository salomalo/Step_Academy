<?xml version="1.0" encoding="windows-1251" ?>

<!DOCTYPE page [
<!ENTITY nbsp "&#160;">
<!ENTITY пробел "&#160;">
<!ENTITY shy "&#173;">
<!ENTITY перенос "&#173;">
]>

<?xml:stylesheet type="text/xsl" href="../common/layout.xsl" ?>

<Урок xmlns="x-schema:Schema.xml" название="Пользователи базы данных."  предыдущий="section02.xml" следующий="section04.xml" copyright="© 2005 Вадим Волянский, Алексей Туманов.">

<h1 style="color:maroon">Пользователи базы данных.</h1>

<p>
Как мы уже говорили, для использования данных, хранящихся в базе данных не достаточно иметь возможность подключиться к серверу. Необходимо еще иметь доступ к самой базе данных. Если пользователь подключился к серверу, но не прошел авторизацию, то при попытке обращения к базе данных будет выведена ошибка. Т.о. далее речь пойдет о предоставлении доступе конкретным пользователям к определенным базам.
</p>

<p>
В каждой базе данных есть специальная таблица sysusers, в которую записывается информация о пользователях текущей базы данных.
</p>

<h4 style="color:#013400">Добавление пользователя в базу данных.</h4>

<p>
Для этого используется хранимая процедура SP_GRANTDBACCESS. Общий синтаксис:
</p>

<pre style="border-color:#FF0000">

Execute sp_grantdbaccess [<b>@loginame</b>=]'имя_учетной_записи' [, [<b>@name_in_db</b>=]'имя_пользователя_в_БД']

</pre>

<p>
<b>ВНИМАНИЕ!!!</b> Пользователь будет добавлен в текущую базу данных.
</p>

<p>
Имя_учетной_записи - это имя, которое указывается для подключения в SQL Server (т.е. кому предоставляется доступ). Имя_пользователя_в_БД - это имя, которое будет иметь пользователь в текущей базе данных. Этот параметр не обязателен. Если его не указать, то автоматически будет взято имя_учетной_записи.
</p>

<p>
Например:
</p>

<pre>
<pre style="border-color:#00FF00">

use library <span style="color=#008080">--открытие базы данных library</span>

</pre>
<pre style="border-color:#00FF00">

Execute sp_grantdbaccess 'test_user' <span style="color=#008080">/*предоставляем пользователю Test_user
доступ к базе данных library.*/</span>

</pre>
</pre>

<p>
Чтобы получить список всех пользователей текущей базы данных необходимо воспользоваться хранимой процедурой SP_HELPUSER. Общий синтаксис:
</p>

<pre style="border-color:#FF0000">

Execute sp_helpuser [[<b>@name_in_db</b>=]'Имя_пользователя_в_БД']

</pre>

<p>
Если не указать Имя_пользователя_в_БД, то отображены будут все пользователи текущей базы данных.
</p>

<p>
При создании базы данных в нее всегда сразу же добавляется один пользователь: это ее владелец. У владельца есть полностью все права на работу с базой данных. Вы помните, что при установке SQL Server необходимо было указать имя пользователя. Там мы указывали sa. Так вот sa автоматически становится владельцем всех баз данных, которые есть на сервере (либо пользователь, указанный при установке). Изначально пользователь dbo соответствует учетной записи sa.
</p>

<p>
Для поддержания безопасности системы иногда приходится менять владельца базы данных. Для этого служит хранимая процедура SP_CHANGEDBOWNER. Общий синтаксис:
</p>

<pre style="border-color:#FF0000">

Execute sp_changedbowner [<b>@loginame</b>=]'имя_нового_владельца'

</pre>

<p>
Имя_нового_владельца это логин пользователя, который становится владельцем базы данных.
</p>

<p>
Существует еще одна учетная запись, позволяющая подключиться к базе данных - это пользователь <b>guest (гость)</b>. Эту учетную запись можно добавить в базу данных, при этом любой пользователь, не имея прав подключения к базе данных, может зайти в нее как гость. Эта учетная запись позволяет только сделать базу данных активной. Все остальные действия запрещены.
</p>

<p>
<b>ВНИМАНИЕ!!!</b> Учетная запись guest должна быть, чтобы пользователь, который имеет доступ к подключению к серверу, но не имеет права доступа ни к одной базе, все же мог подключиться без сообщения об ошибке.
</p>

<h4 style="color:#013400">Удаление пользователя из базы данных.</h4>

<p>
Для удаления пользователя используется хранимая процедура SP_REVOKEDBACCESS. Общий синтаксис:
</p>

<pre style="border-color:#FF0000">

Execute sp_revokedbaccess [<b>@name_in_db</b>=]'имя_пользователя_в_БД'

</pre>

<p>
Имя_пользователя_в_БД - имя пользователя, которому закрывается доступ к текущей базе данных.
</p>

</Урок>