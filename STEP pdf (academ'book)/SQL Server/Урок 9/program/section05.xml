<?xml version="1.0" encoding="windows-1251" ?>

<!DOCTYPE page [
<!ENTITY nbsp "&#160;">
<!ENTITY пробел "&#160;">
<!ENTITY shy "&#173;">
<!ENTITY перенос "&#173;">
]>

<?xml:stylesheet type="text/xsl" href="../common/layout.xsl" ?>

<Урок xmlns="x-schema:Schema.xml" название="Восстановление баз данных."  предыдущий="section04.xml" следующий="section06.xml" copyright="© 2005 Вадим Волянский, Алексей Туманов.">

<h1 style="color:maroon">Восстановление баз данных.</h1>

<p>Вот и пришел момент, когда копия ваших данные, бережно сохраненных заранее, понадобилась. Вы тешете себя тем, что ваши усилия не пропали даром. Теперь нужно потерянную информацию восстановить.</p>


<h3 style="color:#05027E;text-align:center">Понятие контрольных точек.</h3>

<p>При использовании commit transaction, данные из оперативной памяти не сбрасываются автоматически на жесткий диск. Команда commit transaction только лишь подтверждает транзакцию и объявляет ее завершенной для журнала транзакций. Данные будут сохранены на жесткий диск в момент сохранения контрольной точки.
</p>

<p>
За взаимодействия с контрольными точками отвечает специальный процесс, под названием CHECKPOINT. Он определяет момент, когда произойдет сохранение, т.е. когда данные БД, которые были изменены, сохранятся на жесткий диск, а также он отвечает за вставку контрольной точки внутрь журнала транзакций.
</p>

<p>Контрольные точки бывают двух основных видов:</p>

<ol>
	<li><b>Автоматические.</b> <p>Автоматическую контрольную точку выставляет сам SQL server, когда это необходимо. При желании можно воздействовать на периодичность сохранения контрольно точки. Для этого используется специальная опция recovery interval. Опция recovery interval определяет максимальный интервал, который может быть затрачен на автоматическое восстановление базы данных. Этот параметр определяет количество времени в минутах, которое можно потратить на автоматическое восстановление базы данных.  Если количество данных больше чем указанный интервал, SQL Server сбрасывает часть данных на HDD, а в журнал транзакций заносит контрольную точку. Автоматическое сохранение срабатывает также при отключении пользователя от сервера. Также SQL Server обычно производит сохранение автоматически при использовании хранимой процедуры sp_dboption, позволяющей настроить параметры базы данных.</p>
<pre style="border-color:#FF0000">

	Execute <b>sp_dboption</b> [ [ <b><i>@dbname</i></b> = ] 'имя_базы_данных' ] 

	[ , [ <b><i>@optname</i></b> = ] 'название_опции' ] 

	[ , [ <b><i>@optvalue</i></b> = ] 'значение' ]

</pre>

<p>Опция, которая в текущий момент имеет для нас особую ценность, называется <b>trunc. log on chkpt</b>.</p>
<p>Значения, которые можно указывать: <b>TRUE</b>, либо <b>FALSE</b>.</p>
<p>Если эта опция включена, то, при автоматическом выставлении контрольной точки, будет производиться обрезание всех действий, которые были произведены до контрольной точки из журнала транзакций.</p>
<p>Пример изменение этой опции:</p>

<pre style="border-color:863900">

	Execute sp_dboption 'books', 'trunc. log on chkpt', 'true'

</pre>

</li>
	<li><b>Программные.</b>
<p>Для того, чтобы поставить точку программно используется команда CHECKPOINT.</p>
</li>
</ol>

</Урок>